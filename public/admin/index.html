<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GenFree Network Admin</title>
    <style>
      body { font-family: Arial, sans-serif; padding: 20px; }
      .loading { text-align: center; margin: 50px 0; }
      .error { color: red; background: #ffebee; padding: 15px; border-radius: 4px; margin: 10px 0; }
      .success { color: green; background: #e8f5e8; padding: 15px; border-radius: 4px; margin: 10px 0; }
    </style>
  </head>
  <body>
    <div id="status">
      <div class="loading">üîÑ Loading GenFree Network CMS...</div>
      <div id="debug-info"></div>
    </div>

    <script>
      console.log('Starting CMS load process...');
      
      function updateStatus(message, type = 'info') {
        const debugInfo = document.getElementById('debug-info');
        const div = document.createElement('div');
        div.className = type;
        div.innerHTML = message;
        debugInfo.appendChild(div);
        console.log(type.toUpperCase() + ':', message);
      }

      // Test 1: Check if we can load Identity
      updateStatus('‚úì Testing Netlify Identity...', 'info');
      const identityScript = document.createElement('script');
      identityScript.src = 'https://identity.netlify.com/v1/netlify-identity-widget.js';
      identityScript.onload = function() {
        updateStatus('‚úì Netlify Identity widget loaded successfully', 'success');
        
        // Test 2: Check if we can load CMS
        updateStatus('‚úì Testing Decap CMS...', 'info');
        const cmsScript = document.createElement('script');
        cmsScript.src = '/admin/netlify-cms.js';
        cmsScript.onload = function() {
          updateStatus('‚úì Decap CMS script loaded successfully', 'success');
          
          // Test 3: Check if config is accessible
          updateStatus('‚úì Testing config file access...', 'info');
          fetch('/admin/config.yml')
            .then(response => {
              if (response.ok) {
                updateStatus('‚úì CMS config.yml accessible', 'success');
                // Try to initialize CMS
                setTimeout(() => {
                  updateStatus('‚úì Attempting to initialize CMS...', 'info');
                  document.getElementById('status').innerHTML = '<div class="loading">üöÄ Redirecting to CMS interface...</div>';
                  
                  // Replace with actual CMS
                  document.body.innerHTML = '';
                  const finalCmsScript = document.createElement('script');
                  finalCmsScript.innerHTML = `
                    if (window.netlifyIdentity) {
                      window.netlifyIdentity.on("init", user => {
                        if (!user) {
                          window.netlifyIdentity.on("login", () => {
                            document.location.href = "/admin/";
                          });
                        }
                      });
                    }
                  `;
                  document.body.appendChild(finalCmsScript);
                }, 2000);
              } else {
                updateStatus('‚ùå Config file not accessible (Status: ' + response.status + ')', 'error');
              }
            })
            .catch(error => {
              updateStatus('‚ùå Error accessing config: ' + error.message, 'error');
            });
        };
        cmsScript.onerror = function() {
          updateStatus('‚ùå Failed to load Decap CMS script', 'error');
        };
        document.head.appendChild(cmsScript);
      };
      identityScript.onerror = function() {
        updateStatus('‚ùå Failed to load Netlify Identity widget', 'error');
      };
      document.head.appendChild(identityScript);

      // Error catching
      window.addEventListener('error', function(e) {
        updateStatus('‚ùå JavaScript Error: ' + e.message + ' (Line: ' + e.lineno + ')', 'error');
      });
    </script>
  </body>
</html>